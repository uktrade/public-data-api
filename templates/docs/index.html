<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>{{ service_name }} - {{ department_name }}</title>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{{ service_name }} - {{ department_name }}">
    <meta name="twitter:url" content="{{ url_for('docs', _external=True) }}">
    <meta property="og:site_name" content="{{ service_name }}">
    <meta property="og:title" content="{{ service_name }} - {{ department_name }}">
    <meta property="og:type" content="object">
    <meta property="og:url" content="{{ url_for('docs', _external=True) }}">

    <link href="{{ url_for('static', filename='images/favicon.png') }}" rel="shortcut icon" type="image/png">
    <link rel="canonical" href="{{ url_for('docs', _external=True) }}">
    <link href="{{ url_for('static', filename='docs.css') }}" rel="stylesheet">
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
          <div class="govuk-header__container govuk-header__container--full-width">
            <div class="govuk-header__logo">
              <a href="/" class="govuk-header__link govuk-header__link--homepage">
                <span class="govuk-header__logotype">
                  <span class="govuk-header__logotype-text">
                    {{ department_name }}
                  </span>
                </span>
                <span class="govuk-header__product-name">
                  {{ service_name }}
                </span>
              </a>
            </div>
            <div class="govuk-header__content">
              <!-- Placeholder for top level nav -->
            </div>
          </div>
        </header>
      </div>
      <div id="toc-heading" class="toc-show fixedsticky">
        <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
          Table of contents <span class="toc-show__icon"></span>
        </button>
      </div>
      <div class="app-pane__body" data-module="in-page-navigation">
        <div class="app-pane__toc">
          <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
            <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
            <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
              <ul>
                <li>
                  <a href="#top"><span>{{ service_name }}</span></a>
                  <ul>
                    <li>
                      <a href="#api"><span>API Endpoints</span></a>
                      <ul>
                        <li>
                          <a href="#get-specific-version"><span>GET specific version of a dataset</span></a>
                          <ul>
                            <li>
                              <a href="#get-specific-version-range-requests"><span>Range requests</span></a>
                            </li>
                            <li>
                              <a href="#get-specific-version-example-without-query"><span>Example without a query</span></a>
                            </li>
                            <li>
                              <a href="#get-specific-version-example-with-query"><span>Example with a query</span></a>
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a href="#get-latest-version"><span>GET latest version of a dataset</span></a>
                          <ul>
                            <li>
                              <a href="#get-latest-version-example"><span>Example</span></a>
                            </li>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <!-- Main title -->
            <h1 id="top">{{ service_name }}</h1>

            <p>The {{ department_name }} {{ service_name }} supplies datasets to the public.</p>
            <ul>
              <li>Datasets are versioned</li>
              <li>Each dataset version is immutable</li>
              <li>Metadata for each dataset version is available as <a href="https://en.wikipedia.org/wiki/HTML">HTML</a> or <a href="https://www.w3.org/TR/tabular-data-primer/">CSVW</a> (CSV on the Web)</li>
              <li>Columns and rows can be filtered using the <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-glacier-select-sql-reference-select.html">S3 Select query language</a></li>
              <li>Data is supplied as <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> or <a href="https://www.gov.uk/government/publications/recommended-open-standards-for-government/tabular-data-standard">CSV</a></li>
            </ul>

            <p>The source code for the {{ service_name }} is available in its <a href="{{ github_repo_url }}">GitHub repository</a>.</p>

            <!-- API -->
            <h2 id="api">API Endpoints</h2>

            <h3 id="get-specific-version">GET specific version of a dataset</h3>
            <pre><code class="hljs html">GET /v1/datasets/:dataset-id/versions/:version/data</code></pre>
            <h4 id="get-specific-version-query-string-parameters">Query string parameters</h4>
            <table class="govuk-table">
              <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                  <th scope="col" class="govuk-table__header">Name</th>
                  <th scope="col" class="govuk-table__header">Description</th>
                  <th scope="col" class="govuk-table__header">Example</th>
                </tr>
              </thead>
              <tbody class="govuk-table__body">
                <tr class="govuk-table__row">
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">format</code> (required)</td>
                  <td class="govuk-table__cell">The requested output format. In all cases, this must be <code class="hljs html">json</code></td>
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">json</code></td>
                </tr>
                <tr class="govuk-table__row">
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">query-s3-select</code> (optional)</td>
                  <td class="govuk-table__cell">A query using the <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-glacier-select-sql-reference-select.html">S3 Select query language</a>. If specified, the response is a JSON object with results under the <code class="hljs html">rows</code> key, i.e. <code class="hljs html">{"rows": [...]}</code></td>
                  <td scope="row" class="govuk-table__cell"><code class="hljs psql">SELECT * FROM S3Object[*]</code></td>
                </tr>
                <tr class="govuk-table__row">
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">download</code> (optional)</td>
                  <td class="govuk-table__cell">The presence of this parameter results in a <code class="hljs html">content-disposition</code> header so that browsers attempt to download the data rather than display it inline.</td>
                  <td scope="row" class="govuk-table__cell">Not applicable</td>
                </tr>
              </tbody>
            </table>
            <h4 id="get-specific-version-range-requests">Range requests</h4>
            <p>If a <code class="hljs html">query-s3-select</code> is <i>not</i> specified, the <code class="hljs html">range</code> HTTP header can be passed to select a byte-range of the dataset. See <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Range_requests">HTTP Range Requests</a> for more details.</p>

            <h4 id="get-specific-version-example-without-query">Example without a query</h4>
            <h5 id="get-specific-version-example-without-query-request">Request</h5>
            <pre><code class="hljs html">GET /v1/datasets/capital-cities/versions/v0.0.1/data?format=json</code></pre>

            <h5 id="get-specific-version-example-without-a-query-response">Response</h5>
            <pre><code class="hljs html">Status: 200 OK
{
    "capital_cities": [
        {"name": "London", "iso_2_country_code": "GB"},
        {"name": "Paris", "iso_2_country_code": "FR"},
        {"name": "Belgium", "iso_2_country_code": "BE"}
    ]
}</code></pre>

            <h4 id="get-specific-version-example-with-query">Example with a query</h4>
            <h5 id="get-specific-version-example-with-request">Request</h5>
            <pre><code class="hljs html">GET /v1/datasets/capital-cities/versions/v0.0.1/data?format=json&query-s3-select=...</code></pre>
            where <code class="hljs html">...</code> is the below, but URL-encoded

            <pre><code class="hljs psql">SELECT * FROM S3Object[*].capital_cities[*] AS city WHERE city.iso_2_country_code = 'Paris'</code></pre>

            <h5 id="get-specific-version-example-with-query-response">Response</h5>
            <pre><code class="hljs html">Status: 200 OK
{
    "rows": [
        {"name": "Paris", "iso_2_country_code": "FR"}
    ]
}</code></pre>

            <h3 id="get-latest-version">GET latest version of a dataset</h3>
            <pre><code class="hljs html">GET /v1/datasets/:dataset-id/versions/latest/data</code></pre>
            <h4 id="get-latest-version-query-string-parameters">Query string parameters</h4>
            <table class="govuk-table">
              <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                  <th scope="col" class="govuk-table__header">Name</th>
                  <th scope="col" class="govuk-table__header">Description</th>
                  <th scope="col" class="govuk-table__header">Example</th>
                </tr>
              </thead>
              <tbody class="govuk-table__body">
                <tr class="govuk-table__row">
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">format</code> (required)</td>
                  <td class="govuk-table__cell">The requested output format. In all cases, this must be <code class="hljs html">json</code></td>
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">json</code></td>
                </tr>
                <tr class="govuk-table__row">
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">query-s3-select</code> (optional)</td>
                  <td class="govuk-table__cell">A query using the <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-glacier-select-sql-reference-select.html">S3 Select query language</a>. If specified, the response is a JSON object with results under the <code class="hljs html">rows</code> key, i.e. <code class="hljs html">{"rows": [...]}</code></td>
                  <td scope="row" class="govuk-table__cell"><code class="hljs psql">SELECT * FROM S3Object[*]</code></td>
                </tr>
                <tr class="govuk-table__row">
                  <td scope="row" class="govuk-table__cell"><code class="hljs html">download</code> (optional)</td>
                  <td class="govuk-table__cell">The presence of this parameter results in a <code class="hljs html">content-disposition</code> header so that browsers attempt to download the data rather than display it inline.</td>
                  <td scope="row" class="govuk-table__cell">Not applicable</td>
                </tr>
              </tbody>
            </table>

            <h4 id="get-latest-version-example">Example</h4>
            <h5 id="get-latest-version-example-request">Request</h5>
            <pre><code class="hljs html">GET /v1/datasets/capital-cities/versions/latest/data?format=json</code></pre>

            <h5 id="get-latest-version-example-response">Response</h5>
            <pre><code class="hljs html">Status: 302 Found
Location: /v1/datasets/capital-cities/versions/v0.0.1/data?format=json</code></pre>

          </main>
          <footer class="govuk-footer app-footer" role="contentinfo">
            <div class="govuk-footer__meta">
              <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  class="govuk-footer__licence-logo"
                  xmlns="http://www.w3.org/2000/svg"
                  viewbox="0 0 483.2 195.7"
                  height="17"
                  width="41"
                >
                  <path
                    fill="currentColor"
                    d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
                  >
                </svg>
                <span class="govuk-footer__licence-description">
                  All content is available under the
                  <a
                    class="govuk-footer__link"
                    href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
                    rel="license"
                  >Open Government Licence v3.0</a>, except where otherwise stated
                </span>
              </div>
              <div class="govuk-footer__meta-item">
                <a
                  class="govuk-footer__link govuk-footer__copyright-logo"
                  href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
                >© Crown copyright</a>
              </div>
            </div>
          </footer>
        </div>
      </div>
    </div>
    <script src="{{ url_for('static', filename='docs.js') }}"></script>
  </body>
</html>
